steps:
  # Get the submodules
  - name: 'gcr.io/cloud-builders/git'
    id: 'git submodule update'
    args: ['submodule','update', '--init', '--recursive']

#  - name: 'bash'
#    id: 'make'
#    script: |
#      #!/usr/bin/env bash
#      make
#  - name: 'ubuntu'
#    script: make

  - name: 'gcr.io/cloud-builders/go'
    id: 'go version'
    args: [ 'version' ]
    env: [ 'GOPATH=/gopath' ]
    volumes:
      - name: 'go'
        path: '/gopath'

  - name: 'gcr.io/cloud-builders/go'
    id: 'go get -d ./...'
    args: [ 'get', '-d', './...' ]
    env: [ 'GOPATH=/gopath' ]
    volumes:
      - name: 'go'
        path: '/gopath'

#  - name: 'gcr.io/cloud-builders/gcloud'
#    args: [ 'app', 'deploy' ]
#    env: [ 'GOPATH=/gopath' ]
#    volumes:
#      - name: 'go'
#        path: '/gopath'
  - name: 'gcr.io/cloud-builders/go'
    id: 'go build ./...'
    args: ['build','./...']
    env: [ 'GOPATH=/gopath' ]
    volumes:
      - name: 'go'
        path: '/gopath'

  - name: 'gcr.io/cloud-builders/go'
    id: 'go test ./...'
    args: ['test','./...']
    env: [ 'GOPATH=/gopath' ]
    volumes:
      - name: 'go'
        path: '/gopath'

#  # Build the image
#  - name: 'gcr.io/cloud-builders/docker'
#    args: ['build','-t','gcr.io/${_PROJECT}/${_CONTAINERNAME}:${_VERSION}','.']
#
#  #Push the image
#  - name: 'gcr.io/cloud-builders/docker'
#    args: ['push','gcr.io/${_PROJECT}/${_CONTAINERNAME}:${_VERSION}']
#
#
#
#substitutions:
#  #GCP Specific configuration. Please DON'T change anything
#  _PROJECT: learn-gcp-with-mahesh
#
#  #Repository Specific configuration. DevOps can change this settings
#  _DEPLOYMENTNAME: hello-world-service
#  _CONTAINERNAME: hello-world-service
#  _REPO_NAME: cicd-service
#
#  # Developers ONLY change
#  _VERSION: v1.0
#

options:
  logging: CLOUD_LOGGING_ONLY


